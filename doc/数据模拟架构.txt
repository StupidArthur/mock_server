# 模块

PLC组态模块、PLC运行模块、PLC通信模块、PLC监控模块

---

# PLC组态模块

通过UI、配置文件的方式，来定义PLC运行模块需要运行的算法实例(如PID)、配置参数、算法实例控制的模拟物理模型(如水箱模型);

组态模块支持对运行模块的离线配置和在线配置
离线配置：将运行模块停止，清空组态信息，配置全新的组态信息；
在线配置：在不影响运行模块运行的情况下，增删改运行模块的运行组态；

组态模块还可以获得当前运行模块正在运行的组态及其运行信息，予以展示，在此基础上，对其进行修改和更新。

组态范围：

物理模型库（固定）
如水箱模型、阀门模型

控制算法库（固定）
如PID算法

物理模型实例
对支持的物理模型进行实例化的过程，如当前组态需要模拟3个水箱，则用户可定义tank1 tank2 tank3 3个实例，并配置其初始参数（如水箱高度,出水口横截面积等），
若水箱模型本身有参数h, s，则在实例化后，就会存在tank1.h tank1.s tank2.h等等这些有实际意义的参数

控制算法实例
对支持的控制算法进行实例化的过程，如当前有3个模拟水箱，需要用4个PID算法来控制液位，则用户可定义pid1 pid2 pi3_1 pid3_2 4个实例，并配置其初始参数（如SV等等），同理，pid3_1.SV就会成为一个有意义的参数


关联关系
算法实例的参数、模型实例的参数需要做一定的连接，才能让控制产生意义，比如tank1的液位高度，与pid1的PV相连，pid1的MV与阀门模型的输入相连，阀门模型的输出与水箱的进水口大小相连，这样才能实现一个物理意义上的控制；比如pid3_1的MV与pid3_2的PV相连，pid3_2的MV与阀门相连，这样才能实现一个二阶PID控制。


PLC运行周期

---

# PLC运行模块

运行模块中，每个运行周期(独立运行在一个线程中)将执行已经组态的控制算法和物理模型的时序计算。

在每个周期中，依次为：从物理模型实例中采样数据 -> 数据给到控制算法实例的参数 -> 执行控制算法 -> 控制算法的输出参数给到物理模型实例 -> 物理模型实例执行(物理模型的时序推进)

在每个周期结束的时候，运行模块将数据（每个算法实例、物理模型实例的所有参数）推到他的redis上，供其他模块获取；

---

# PLC通信模块

在组态模块每次更新组态信息给运行模块时，通信模块也会收到一份，然后会根据组态信息（实例名、实例参数），每个通信周期向运行模块的redis拿当前周期的数据，更新到自己的对外输出协议上（如OPCUA）。

OPCUA Server地址为 opc.tcp://0.0.0.0:18951

默认的通信周期是0.5秒

---

# PLC数据模块

在组态模块每次更新组态信息给运行模块时，数据模块也会收到一份，然后会根据组态信息（实例名、实例参数），每个存储周期向运行模块的额redis那当前周期的数据，更新到本地数据库sqlite，同时对外实现历史数据查询接口，历史数据统计接口

---

# PLC监控模块

界面化、图表化展示历史数据查询、历史数据统计接口