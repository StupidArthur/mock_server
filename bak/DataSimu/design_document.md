# 数据模拟平台

---

### 总设

本目录下将使用以下技术实现一个工业数据模拟的系统。

python3.13
simple_pid
control
scipy
pandas
numpy
matplotlib

---

### 模块划分

#### 物理模型

物理模型在module目录下，每个模型一个类

- BaseModule 父类模型

> 实例化参数 步进时间 step

> 运行输入参数 

> 物理模型介绍：模型根据每个子类设定的实例化参数进行实例化，然后按照各自的物理意义实现过程模拟，每运行一次execute(*args， step=step)，返回其输出参数。


- cylindrical_tank 圆柱体水箱模型（基于父类模型）

> 实例化参数：水箱高度，水箱半径，水箱入水管（圆形）满开面积， 入水口水流速，水箱出水口面积，初始水位高度，步进时间

> 运行输入参数：入水管阀门开度x: float（0~1）

> 运行输出参数：水箱液位高度

> 物理模型介绍：一个圆柱体的水箱，在水箱最高同高的地方有一个圆形的入水管口，他由一个阀门（0~100）控制，在水箱最低的地方有一个圆形的出水口，一直在出水，出水的流量与当前水位高度相关（根据托里拆利）。

- valve 阀门模型（基于父类模型）

> 实例化参数：控制上下限0 1，或0.2 0.8，步进时间， 满行程达成时间

> 运行输入参数：控制目标值

> 运行输出参数：阀门开度

> 物理模型介绍：当阀门给予一个控制目标值的时候，并不是瞬间就能达成的，而是根据当前开度和目标开度有一个线性的行程过程，如满行程达成时间为20秒，当前开度是0.2，要控制到0.8，目标持续不变，则需要20 * (0.8 - 0.2) / 1 = 12秒。阀门开度精度设置为0.0001。

---

#### 控制算法

控制算法在Algorithm目录下，每个算法一个类

- BaseAlgorithm 基础模块

> 实例化参数： 名称，初始配置参数，初始输入参数，初始输出参数

> 运行输入参数：输入参数和配置参数

> 运行输出参数：全量参数以字典的方式输出

> 算法逻辑介绍：每调用1次execute，进行一次算法运算

---

- PID based_on BaseAlgorithm

> 实例化参数： name，kp, Ti, Td, pv, sv, mv, h, l，T

> 运行输入参数：pv, sv, kp, Ti, Td

> 运行输出参数：kp, Ti, Td, pv, sv, mv

> 算法逻辑介绍：通用的PID算法

---

### PLC层

PLC层的代码在PLC目录下

- 组态模板设计：
    需求：需要表示出当前需要运行的每个模型、算法实例及其参数；需要表示出模型和算法之间的连接和映射关系（如当前需要模拟一个， PID使用阀门控制水箱液位高度的案例，那么组态模板中，需要实例化一个水箱，一个阀门，一个PID算法， 将阀门的输出连接到水箱的输入， 将水箱液位映射到PID的PV，将PID的MV映射到阀门的控制目标）；需要表示出系统的运行周期；

- 组态模板运行模块

- 时钟模块

- 运行数据导出模板(每个实例化的模型和算法都有一个名字object, 也有自己的参数args， object.args作为模板中的名字)

- 数据模拟模块（based on 组态模板运行模块），非阻塞地运行，输出excel数据

- 仿真运行模块（based on 组态模板运行模块），按运行周期模拟运行，每个周期输出结果，通过外挂的通信模块将数据传到到外部（如OPCUA， http， websocket等）





